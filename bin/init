#!/usr/bin/env bash -xe
runNpmInstall () {
    cd $1/$2
    rm -rf node_modules/
    npm install --no-optional --no-package-lock
    cd ../.. 
}

runInit () {
    local DIVIDER="===================="
    local TEMPLATE="\n${DIVIDER}${DIVIDER}${DIVIDER}\nInitializing %s\n\n"

    local PACKAGES=( hive-js hive-js-rest-example hive-js-domain-example )
    local CONTAINERS=( hive-base-js hive-consumer-js hive-producer-js hive-stream-processor-js )

    printf "${TEMPLATE}" "Monorepo"
    npx lerna bootstrap

    printf "${TEMPLATE}" "Packages"
    for p in "${PACKAGES[@]}"
    do
        runNpmInstall packages $p
    done

    printf "${TEMPLATE}" "Containers"
    for c in "${CONTAINERS[@]}"
    do
        runNpmInstall containers $c
    done

    printf "${TEMPLATE}" "Proxy"
    cd dev/proxy/cert
    bash create
    cd ../../..
}

runInit && exit 0
